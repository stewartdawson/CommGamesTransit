<!DOCTYPE html>
<meta charset="utf-8">
<style>
path{
                fill:#FFF;
                stroke: lightgrey;
}
svg{
  border:1px solid black;
}
#legend
{
  float:right;
  margin-right: 100px;
}
li
{
  list-style-type:none;
}
.glasgow{fill:#F2F2F2;}
.river{
  fill:#F2F2F2;
  stroke-width:1.2;
  stroke:lightblue;
}
.venue
{
  stroke-width:1.2;
  stroke:green;
  fill:green;
  opacity:0.2 ;
}
.station
{
  stroke:grey;
  fill:orange;
  opacity:0.6;
}
.bus_stop
{
  stroke:grey;
  fill:lightblue;
  opacity:0.6;
}
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>
var width = 600,
    height = 600;

var projection = d3.geo.albers()
    .center([0.2, 55.8])
    .rotate([4.4, 0])
    .parallels([50, 60])
    .scale(120000)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

  function clear()
  {
    svg.selectAll(".area").remove();
    svg.selectAll('.glasgow').remove();
    svg.selectAll('.river').remove();
    svg.selectAll('image').remove();
    svg.selectAll('.venue').remove();
    svg.selectAll(".station").remove();
    svg.selectAll(".bus_stop").remove();
  }

d3.json("topo/glasgow.json", function(error, uk) {
  function displayGlasgow()
  {
      clear();

      svg.append("path")
      .datum(topojson.feature(uk, uk.objects.glasgow))
      .attr("d", path)
      .attr('class', 'glasgow');

      svg.selectAll(".river")
      .data(topojson.feature(uk, uk.objects.riverClyde).features)
      .enter().append('path')
      .attr('class', 'river').attr("d", path);

    projection.center([0.2, 55.8]).scale(120000); //set the scale before calculating the centroids for the images
    svg.selectAll('path').transition().duration(800).attr('d', path);
    rug = path.centroid(topojson.feature(uk, uk.objects.Ibrox));
    //console.log('place logo here: ' + rug);

svg.selectAll('.rugby').data([0]).enter()
  .append('svg:image')
   .attr('x',rug[0]-23)
   .attr('y',rug[1]-24)//subtract half the size of the image
   .attr('width', 46)
   .attr('height',48)
   .attr("xlink:href","imgs/rugby-sevens.png")
   .on('click', function(){displayArea(uk.objects.IbroxArea, [0.09, 55.848], uk.objects.Ibrox, uk.objects.IbroxTransit);});

    //svg.selectAll(".ibroxArea")
    //  .data(topojson.feature(uk, uk.objects.Ibrox).features)
    //  .enter().append("path")
    //  .attr("class", function(d) { return d.id; })
    //  .on('click', function(){displayArea(uk.objects.IbroxArea, [0.09, 55.848])})
    //  .attr("d", path);

  }
  function displayArea(dat, cent, ven, trans)
  {
    clear();

    svg.selectAll(".area")
    .data(topojson.feature(uk, dat).features)
    .enter().append("path")
    .attr("class", function(d) { return d.id; })
    .attr("d", path)
    .on('click', function(){displayGlasgow();});

    svg.selectAll('.venue')
    .data(topojson.feature(uk, ven).features)
    .enter().append('path')
    .attr('class', 'venue')
    .attr('d', path);

    svg.selectAll(".transit")
      .data(topojson.feature(uk, trans).features)
      .enter().append("path")
      .attr("class", function(d){ if(d.properties.highway=='bus_stop') {return "bus_stop"} else {return "station";}})
      .attr("d", path).on('click', function(d){console.log(d.properties.highway);});

    //projection.center([0.09,55.848]).scale(1600000);
    projection.center(cent).scale(1600000);
    svg.selectAll('path').transition().duration(1000).attr('d', path);
  }
  displayGlasgow();
});
</script>
<div id="legend">
  <ol>
    <li>Ibrox Subway - 2mins</li>
    <li>Cessnock Subway - 2mins</li>
  </ol>
</div>
</body>
